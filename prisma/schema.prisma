// ge/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

enum PublicationType {
  NEWS
  ARTICLE
}

// Publication with language-agnostic parent and translatable children
model Publication {
  id          String      @id @default(uuid())
  type        PublicationType
  date        DateTime
  bannerImage String?
  ogImage     String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  translations PublicationTranslation[]
  categories   PublicationCategory[]

  @@map("publications")
}

model PublicationTranslation {
  id           String       @id @default(uuid())
  languageCode String
  title        String
  content      String       @db.LongText
  slug         String

  publicationId String
  publication   Publication  @relation(fields: [publicationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([publicationId, languageCode])
  @@unique([languageCode, slug])
  @@index([languageCode])
  @@map("publication_translations")
}

model Category {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  translations CategoryTranslation[]
  publications PublicationCategory[]

  @@map("categories")
}

model CategoryTranslation {
  id           String   @id @default(uuid())
  languageCode String
  name         String

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([categoryId, languageCode])
  @@unique([languageCode, name])
  @@index([languageCode])
  @@map("category_translations")
}

model PublicationCategory {
  publicationId String
  categoryId    String

  publication Publication @relation(fields: [publicationId], references: [id], onDelete: Cascade)
  category     Category   @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([publicationId, categoryId])
  @@map("publication_categories")
}


// Models for Admin Panel with Users, Roles, Divisions, Units, and Refresh Tokens
model User {
  id                String      @id @default(uuid())
  name              String
  email             String      @unique
  roleId            String
  unitId            String
  divisionId        String?
  role              Role        @relation(fields: [roleId], references: [id])
  unit              Unit        @relation(fields: [unitId], references: [id])
  division          Division?   @relation(fields: [divisionId], references: [id])
  refreshTokens     RefreshToken[]

  @@map("users")
}

model Role {
  id         String @id @default(uuid())
  name       String @unique
  users      User[]

  @@map("roles")
}

model Division {
  id         String   @id @default(uuid())
  name       String   @unique
  users      User[]

  @@map("divisions")
}

model Unit {
  id                         String   @id @default(uuid())
  code                       String   @unique
  name                       String   @unique
  users                      User[]
  @@map("units")
}

// Guest book entries for office visitors
model GuestBook {
  id              String   @id @default(uuid())
  name            String
  origin          String
  purpose         String
  reason          String
  selfieImage     String
  signatureImage  String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("guest_books")
}

// For Auth
model RefreshToken {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  tokenHash  String   @unique
  revoked    Boolean  @default(false)
  replacedBy String?
  createdAt  DateTime @default(now())
  expiresAt  DateTime

  @@map("refresh_tokens")
}